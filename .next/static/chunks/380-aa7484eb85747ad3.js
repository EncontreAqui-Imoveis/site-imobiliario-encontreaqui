"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[380,960],{960:(e,r,t)=>{async function o(e,r){try{let t=(null==r?void 0:r.body)instanceof FormData,o={...null==r?void 0:r.headers};t||(o["Content-Type"]="application/json");let a=await fetch("".concat("https://backend-production-6acc.up.railway.app").concat(e),{headers:o,...r});if(!a.ok){let r=await a.json().catch(()=>({}));return console.error("âŒ [API] Erro na requisi\xe7\xe3o:",{status:a.status,endpoint:e,errorData:r}),{error:r.message||"HTTP error ".concat(a.status),data:r}}let i=await a.text();if(!i)return{data:void 0};try{return{data:JSON.parse(i)}}catch(e){return{data:void 0}}}catch(e){return console.error("API error:",e),{error:"Erro de conex\xe3o. Tente novamente."}}}t.d(r,{Gp:()=>n,aE:()=>s,authApi:()=>i,propertiesApi:()=>a,vx:()=>c});let a={getAll:e=>{let r=e?"?".concat(new URLSearchParams(e)):"";return o("/properties".concat(r))},getById:e=>o("/properties/".concat(e)),getFeatured:()=>o("/properties?featured=true&limit=6"),getRecent:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;return o("/properties?status=approved&limit=".concat(e,"&sort=created_at:desc"))},search:e=>{let r=new URLSearchParams(e).toString();return o("/properties/search?".concat(r))},create:(e,r)=>o("/properties",{method:"POST",body:e instanceof FormData?e:JSON.stringify(e),headers:{Authorization:"Bearer ".concat(r)}}),getByOwner:(e,r)=>o("/properties/me",{headers:{Authorization:"Bearer ".concat(r)}}),update:(e,r,t)=>{let a=r instanceof FormData;return o("/properties/".concat(e),{method:"PUT",body:a?r:JSON.stringify(r),headers:{Authorization:"Bearer ".concat(t)}})}},i={login:(e,r)=>o("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:r})}),register:e=>o("/auth/register",{method:"POST",body:JSON.stringify(e)}),checkEmailStatus:e=>o("/auth/check-email?email=".concat(encodeURIComponent(e.trim().toLowerCase()))),requestPasswordReset:e=>o("/auth/password-reset/request",{method:"POST",body:JSON.stringify({email:e})}),googleAuth:(e,r)=>o("/auth/google",{method:"POST",body:JSON.stringify({idToken:e,profileType:r})}),updateProfile:e=>{let r=localStorage.getItem("token");return r?o("/users/profile",{method:"PUT",body:JSON.stringify(e),headers:{Authorization:"Bearer ".concat(r)}}):Promise.resolve({error:"N\xe3o autenticado"})},requestBrokerUpgrade:e=>{let r=localStorage.getItem("token");return r?o("/brokers/me/request-upgrade",{method:"POST",body:JSON.stringify(e),headers:{Authorization:"Bearer ".concat(r)}}):Promise.resolve({error:"N\xe3o autenticado"})},uploadBrokerDocuments:e=>{let r=localStorage.getItem("token");if(!r)return Promise.reject(Error("N\xe3o autenticado"));let t=new FormData;return t.append("creci",e.creci),t.append("creciFront",e.creciFront),t.append("creciBack",e.creciBack),t.append("selfie",e.selfie),o("/brokers/me/verify-documents",{method:"POST",body:t,headers:{Authorization:"Bearer ".concat(r)}})}},n={getAll:e=>o("/users/favorites",{headers:{Authorization:"Bearer ".concat(e)}}),add:(e,r)=>o("/users/favorites/".concat(e),{method:"POST",headers:{Authorization:"Bearer ".concat(r)}}),remove:(e,r)=>o("/users/favorites/".concat(e),{method:"DELETE",headers:{Authorization:"Bearer ".concat(r)}})},c={getAll:e=>o("/users/notifications",{headers:{Authorization:"Bearer ".concat(e)}}),markAsRead:(e,r)=>o("/users/notifications/".concat(e,"/read"),{method:"PATCH",headers:{Authorization:"Bearer ".concat(r)}}),markAllAsRead:e=>o("/users/notifications/read-all",{method:"POST",headers:{Authorization:"Bearer ".concat(e)}})},s={getPerformanceReport:e=>o("/brokers/me/performance",{headers:{Authorization:"Bearer ".concat(e)}}),getCommissions:e=>o("/brokers/me/commissions",{headers:{Authorization:"Bearer ".concat(e)}})}},4585:(e,r,t)=>{let o,a,i;t.d(r,{F0:()=>u,G6:()=>s,HW:()=>f,Tq:()=>l,gj:()=>h,i:()=>v,jW:()=>S,kH:()=>d,vC:()=>y,zE:()=>p});var n=t(2078),c=t(2553);try{o=(0,n.Dk)().length?(0,n.Sx)():(0,n.Wp)({apiKey:"AIzaSyDp2MfcERy2t6SdSODAxK1VqHgx2VSoM2o",authDomain:"encontreaqui-imoveis.firebaseapp.com",projectId:"encontreaqui-imoveis",storageBucket:"encontreaqui-imoveis.firebasestorage.app",messagingSenderId:"442509320982",appId:"1:442509320982:web:65b2b1c3a544c10d2d2637"}),a=(0,c.getAuth)(o),i=new c.GoogleAuthProvider}catch(e){console.error("Firebase initialization error:",e)}async function s(){try{let e=await (0,c.signInWithPopup)(a,i);return await e.user.getIdToken()}catch(e){if((null==e?void 0:e.code)==="auth/popup-closed-by-user"||(null==e?void 0:e.code)==="auth/cancelled-popup-request")return null;throw console.error("Google Sign-In Error:",e),Error("N\xe3o foi poss\xedvel fazer login com Google. Tente novamente.")}}async function l(e,r){try{return await (0,c.createUserWithEmailAndPassword)(a,e,r)}catch(e){if(console.error("Create User Error:",e),"auth/email-already-in-use"===e.code)throw Error("Este email j\xe1 est\xe1 cadastrado.");if("auth/weak-password"===e.code)throw Error("A senha deve ter pelo menos 6 caracteres.");if("auth/invalid-email"===e.code)throw Error("Email inv\xe1lido.");throw Error("Erro ao criar conta. Tente novamente.")}}async function u(e,r){try{return await (0,c.signInWithEmailAndPassword)(a,e,r)}catch(e){if(console.error("Sign In Error:",e),"auth/user-not-found"===e.code)throw Error("Usu\xe1rio n\xe3o encontrado.");if("auth/wrong-password"===e.code||"auth/invalid-credential"===e.code)throw Error("Senha incorreta.");if("auth/invalid-email"===e.code)throw Error("Email inv\xe1lido.");throw Error("Erro ao fazer login. Tente novamente.")}}async function d(){let e=a.currentUser;if(!e)throw Error("Nenhum usu\xe1rio logado.");try{await (0,c.sendEmailVerification)(e)}catch(e){if(console.error("Send Verification Email Error:",e),"auth/too-many-requests"===e.code)throw Error("Muitas tentativas. Aguarde alguns minutos.");throw Error("Erro ao enviar email de verifica\xe7\xe3o.")}}async function h(){let e=a.currentUser;if(!e)return!1;try{return await e.reload(),e.emailVerified}catch(e){return console.error("Refresh User Error:",e),!1}}function f(){return a.currentUser}let m=null,g=null;function p(e){if(m)try{m.clear()}catch(e){}return m=new c.RecaptchaVerifier(a,e,{size:"normal",callback:()=>{console.log("reCAPTCHA solved")},"expired-callback":()=>{console.log("reCAPTCHA expired")}})}async function y(e){if(!m)throw Error("Configure o reCAPTCHA primeiro.");try{return g=await (0,c.signInWithPhoneNumber)(a,e,m)}catch(e){if(console.error("Send SMS Error:",e),"auth/invalid-phone-number"===e.code)throw Error("N\xfamero de telefone inv\xe1lido.");if("auth/too-many-requests"===e.code)throw Error("Muitas tentativas. Aguarde alguns minutos.");if("auth/captcha-check-failed"===e.code)throw Error("Verifica\xe7\xe3o reCAPTCHA falhou. Tente novamente.");throw Error("Erro ao enviar SMS. Tente novamente.")}}async function v(e){if(!g)throw Error("Envie o SMS primeiro.");try{return await g.confirm(e)}catch(e){if(console.error("Verify SMS Error:",e),"auth/invalid-verification-code"===e.code)throw Error("C\xf3digo incorreto.");if("auth/code-expired"===e.code)throw Error("C\xf3digo expirado. Solicite um novo.");throw Error("Erro ao verificar c\xf3digo. Tente novamente.")}}function S(){if(m){try{m.clear()}catch(e){}m=null}g=null}},5380:(e,r,t)=>{t.d(r,{A:()=>l,O:()=>s});var o=t(5155),a=t(2115),i=t(960),n=t(4585);let c=(0,a.createContext)(void 0);function s(e){let{children:r}=e,[s,l]=(0,a.useState)(null),[u,d]=(0,a.useState)(!0),[h,f]=(0,a.useState)([]),[m,g]=(0,a.useState)(0);(0,a.useEffect)(()=>{let e=localStorage.getItem("user"),r=localStorage.getItem("token"),t=localStorage.getItem("favorites");e&&r&&l(JSON.parse(e)),t&&f(JSON.parse(t)),d(!1)},[]);let p=(0,a.useCallback)(async()=>{let e=localStorage.getItem("token");if(e)try{let r=await i.vx.getAll(e);if(r.data){let e=(Array.isArray(r.data)?r.data:r.data.data||r.data.notifications||[]).filter(e=>!e.is_read).length;g(e)}}catch(e){console.error("Error fetching notifications count:",e)}},[]);(0,a.useEffect)(()=>{s?p():g(0)},[s,p]),(0,a.useEffect)(()=>{s&&localStorage.setItem("favorites",JSON.stringify(h))},[h,s]);let y=async(e,r)=>{d(!0);try{let t=await i.authApi.login(e,r);if(t.error)throw Error("string"==typeof t.error?t.error:"Erro ao fazer login");let{user:o,token:a}=t.data;l(o),localStorage.setItem("user",JSON.stringify(o)),localStorage.setItem("token",a);try{let e=await i.Gp.getAll(a);if(e.data){let r=e.data.map(e=>e.id);f(r),localStorage.setItem("favorites",JSON.stringify(r))}}catch(e){console.error("Error loading favorites:",e)}}finally{d(!1)}},v=async e=>{d(!0);try{var r,o,a;let c=await (0,n.G6)();if(!c)return{success:!1};let{user:s}=await Promise.resolve().then(t.bind(t,2553)).then(e=>({user:e.getAuth().currentUser}));if(!(null==s?void 0:s.email))throw Error("Email n\xe3o fornecido pelo Google");let u=await i.authApi.checkEmailStatus(s.email);if(u.error)throw Error("Erro ao verificar status do email");if(!(null==(r=u.data)?void 0:r.exists))return{success:!1,needsRegistration:!0,pending:{email:s.email,name:s.displayName||"",uid:s.uid,photoURL:s.photoURL,idToken:c}};let d=await i.authApi.googleAuth(c,e);if(d.error)throw Error("string"==typeof d.error?d.error:"Erro ao fazer login com Google");if(null==(o=d.data)?void 0:o.requiresProfileChoice)return{success:!1,requiresProfileChoice:!0,pending:{email:s.email,name:s.displayName||""}};let{user:h,token:m,needsCompletion:g,requiresDocuments:p}=d.data;l(h),localStorage.setItem("user",JSON.stringify(h)),localStorage.setItem("token",m);try{let e=await i.Gp.getAll(m),r=null!=(a=e.data)?a:e;if(Array.isArray(r)){let e=r.map(e=>e.id);f(e),localStorage.setItem("favorites",JSON.stringify(e))}}catch(e){console.error("Error loading favorites:",e)}return{success:!0,needsCompletion:g,requiresDocuments:p}}catch(e){throw console.error("Google login error:",e),e}finally{d(!1)}},S=async e=>{let r=localStorage.getItem("token");if(!h.includes(e)&&(f(r=>[...r,e]),r))try{await i.Gp.add(e,r)}catch(r){console.error("Error adding favorite:",r),f(r=>r.filter(r=>r!==e))}},E=async e=>{let r=localStorage.getItem("token");if(f(r=>r.filter(r=>r!==e)),r)try{await i.Gp.remove(e,r)}catch(r){console.error("Error removing favorite:",r),f(r=>[...r,e])}},w=e=>h.includes(e),A=(0,a.useCallback)((e,r)=>{localStorage.setItem("token",r),localStorage.setItem("user",JSON.stringify(e)),l(e),p()},[p]),k=async e=>{if(!localStorage.getItem("token"))return{success:!1,error:"N\xe3o autenticado"};try{let r=await i.authApi.updateProfile(e);if(r.error)return{success:!1,error:r.error};if(r.data&&r.data.user){let e=r.data.user;return l(e),localStorage.setItem("user",JSON.stringify(e)),{success:!0}}return{success:!1,error:"Resposta inv\xe1lida do servidor"}}catch(e){return{success:!1,error:e.message||"Erro ao atualizar perfil"}}};return(0,o.jsx)(c.Provider,{value:{user:s,isAuthenticated:!!s,isLoading:u,favorites:h,login:y,loginWithGoogle:v,logout:()=>{l(null),f([]),localStorage.removeItem("user"),localStorage.removeItem("token"),localStorage.removeItem("favorites")},addFavorite:S,removeFavorite:E,isFavorite:w,toggleFavorite:e=>{w(e)?E(e):S(e)},unreadNotifications:m,refreshUnreadCount:p,setSession:A,updateProfile:k},children:r})}function l(){let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);